var express      = require('express'),
    passport     = require('passport'),
    LdapStrategy = require('./lib/passport-ldapauth').Strategy;

var OPTS = {
  server: {
    url: 'ldap://localhost:12345',
    searchBase: 'ou=passport-ldapauth',
    searchFilter: '(uid={{username}})'
  }
};

var app = express();

passport.use(new LdapStrategy(OPTS));

app.configure(function() {
  app.use(express.bodyParser());
  app.use(passport.initialize());
});

app.all('*', function(req, res, next) {
  console.log('Request');
  next();
});

app.post('/login', passport.authenticate('ldapauth', {session: false}), function(req, res) {
  res.send({status: 'ok'});
});

app.listen(8080);
